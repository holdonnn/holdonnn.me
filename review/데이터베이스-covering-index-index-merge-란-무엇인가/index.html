<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta name="google-site-verification" content="JA_ocNhbTh2OZYc6XdvGU86Tu-KrppkZddT3_sfwTDU"/><style data-href="/styles.3237bdba28356b2256c5.css" id="gatsby-global-css">article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{font-family:georgia,serif;word-wrap:break-word;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.45rem}h3{font-size:1.3rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:var(--border-color);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid var(--border-color);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}h1,h2,h3:lang(ko){word-break:keep-all}:root{--oc-gray-0:#f8f9fa;--oc-gray-0-rgb:248,249,250;--oc-gray-1:#f1f3f5;--oc-gray-1-rgb:241,243,245;--oc-gray-2:#e9ecef;--oc-gray-2-rgb:233,236,239;--oc-gray-3:#dee2e6;--oc-gray-3-rgb:222,226,230;--oc-gray-4:#ced4da;--oc-gray-4-rgb:206,212,218;--oc-gray-5:#adb5bd;--oc-gray-5-rgb:173,181,189;--oc-gray-6:#868e96;--oc-gray-6-rgb:134,142,150;--oc-gray-7:#495057;--oc-gray-7-rgb:73,80,87;--oc-gray-8:#343a40;--oc-gray-8-rgb:52,58,64;--oc-gray-9:#212529;--oc-gray-9-rgb:33,37,41;--bg-color:#fff;--border-color:var(--oc-gray-2);--title-color:var(--oc-gray-8);--subtitle-color:var(--oc-gray-7);--text-color:var(--oc-gray-8);--hover-color:var(--oc-gray-2)}@media (prefers-color-scheme:dark){:root{--bg-color:var(--oc-gray-8);--border-color:var(--oc-gray-7);--title-color:var(--oc-gray-4);--subtitle-color:var(--oc-gray-4);--text-color:var(--oc-gray-4);--hover-color:var(--oc-gray-9)}}*{font-family:Noto Sans KR,Noto Sans,sans-serif;font-weight:400;color:var(--text-color)}body,html{background-color:var(--bg-color);margin:0;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media only screen and (max-width:480px){html{font-size:100%}}li,p{font-size:1.15rem;line-height:1.7rem;font-weight:500}blockquote{background:var(--hover-color);border-left:10px solid var(--border-color);margin:1.5em 0;padding:.5em .5rem .5rem 2rem;quotes:"\201C" "\201D" "\2018" "\2019"}blockquote:before{color:#ccc;content:open-quote;font-size:4em;margin-left:-.5em;line-height:.1em;vertical-align:-.7em}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">covering index 와 index merge </title><meta data-react-helmet="true" name="og:description" content="Jaehyun Baek blog"/><meta data-react-helmet="true" name="og:image" content="https://byjay.github.io/img/og.jpeg"/><meta data-react-helmet="true" name="title" content="covering index 와 index merge "/><meta data-react-helmet="true" name="description" content="데이터베이스 인덱스 테이블은 메인 데이터 공간과 분리되어 있다"/><meta data-react-helmet="true" name="keywords" content="covering index 와 index merge "/><meta data-react-helmet="true" name="image" content="https://byjay.github.io/static/nude.jpg"/><meta data-react-helmet="true" property="og:description" content="데이터베이스 인덱스 테이블은 메인 데이터 공간과 분리되어 있다"/><meta data-react-helmet="true" property="og:title" content="covering index 와 index merge "/><meta data-react-helmet="true" property="og:image" content="https://byjay.github.io/static/nude.jpg"/><style data-styled="dqAYEl gmwDMj kQfDtZ iEMvau zGkDl jjlvoM FlGJT hCVLFF dyUQaX dKCvWe bBlDrk" data-styled-version="4.4.1">
/* sc-component-id: Profile__Wrapper-z34zrb-0 */
.dqAYEl{margin:0 auto;padding:0.5rem;text-align:left;border-bottom:1px solid var(--border-color);margin-bottom:1.0rem;-webkit-transition:0.4s;transition:0.4s;position:fixed;width:100%;background-color:var(--bg-color);}
/* sc-component-id: Profile__Title-z34zrb-1 */
.gmwDMj{display:inline-block;font-weight:bold;font-size:1.3rem;margin:0.2rem 0;padding:0.25rem 0.5rem;color:var(--title-color);-webkit-transition:all 0.3s ease;transition:all 0.3s ease;} .gmwDMj:hover{background-color:var(--hover-color);border-radius:3px;}
/* sc-component-id: Profile__NavList-z34zrb-2 */
.kQfDtZ{color:var(--subtitle-color);font-size:0.8rem;line-height:1.2rem;margin:0;} .kQfDtZ li{display:inline;}
/* sc-component-id: Profile__OutLink-z34zrb-3 */
.iEMvau{-webkit-text-decoration:none;text-decoration:none;color:var(--subtitle-color);padding:0.25rem;margin:0.25rem;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;} .iEMvau:hover{background-color:var(--hover-color);border-radius:3px;}
/* sc-component-id: Layout__Content-sc-15rk51y-0 */
.zGkDl{padding:120px 50px;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;background-color:var(--bg-color);} @media (max-width:48em){.zGkDl{padding:100px 20px;}}
/* sc-component-id: BuyMe__Wrapper-sc-8e0gb5-0 */
.bBlDrk{text-align:center;}
/* sc-component-id: post__Wrapper-q9naw2-0 */
.jjlvoM{max-width:600px;margin:auto;}
/* sc-component-id: post__Time-q9naw2-1 */
.dyUQaX{font-weight:300;font-size:0.6rem;text-align:right;color:var(--subtitle-color);}
/* sc-component-id: post__Title-q9naw2-2 */
.FlGJT{font-weight:bold;font-size:2rem;line-height:2rem;text-align:center;margin:0.5rem 0;word-break:keep-all;color:var(--title-color);}
/* sc-component-id: post__Description-q9naw2-3 */
.hCVLFF{color:var(--subtitle-color);font-size:0.9rem;word-break:keep-all;text-align:center;margin:0.5rem 0;}
/* sc-component-id: post__Content-q9naw2-4 */
@media (max-width:48em){.dKCvWe iframe{width:100%;height:100%;}} .dKCvWe img{display:block;margin:0 auto;} .dKCvWe h3{line-height:1.4;}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-bc129be22fe40e80e254.js"/><link as="script" rel="preload" href="/framework-82eb919642398bad2a1f.js"/><link as="script" rel="preload" href="/styles-31f023f48facb69035d3.js"/><link as="script" rel="preload" href="/532a2f07-d9cf671676a4930bc377.js"/><link as="script" rel="preload" href="/app-cd2e1915a6dbf9312162.js"/><link as="script" rel="preload" href="/4cb257886639e7cece3b127408f64a9a0759d72b-4a877f0b9a52a4ca872b.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-71924c030ab130b7cd23.js"/><link as="fetch" rel="preload" href="/page-data/review/데이터베이스-covering-index-index-merge-란-무엇인가/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><link rel="shortcut icon" href="/static/favicon-ea95dcc35d02c2938216c10ccfdfe44a.png"/><link rel="preconnect" href="https://fonts.googleapis.com/css?family=Noto+Sans|Noto+Sans+KR&amp;display=swap"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="Profile__Wrapper-z34zrb-0 dqAYEl"><div class="Profile__Title-z34zrb-1 gmwDMj"><a href="/" style="text-decoration:none;color:inherit">Jaehyun Baek</a></div><ul class="Profile__NavList-z34zrb-2 kQfDtZ"><li><a href="/" class="Profile__OutLink-z34zrb-3 iEMvau">home</a></li>·<li><a href="/review" class="Profile__OutLink-z34zrb-3 iEMvau">review</a></li>·<li><a href="/wiki" class="Profile__OutLink-z34zrb-3 iEMvau">wiki</a></li>·<li><a href="/about" class="Profile__OutLink-z34zrb-3 iEMvau">about</a></li>·<li><a href="/search" class="Profile__OutLink-z34zrb-3 iEMvau">search</a></li></ul></nav><div class="Layout__Content-sc-15rk51y-0 zGkDl"><div class="post__Wrapper-q9naw2-0 jjlvoM"><h1 class="post__Title-q9naw2-2 FlGJT">covering index 와 index merge </h1><div class="post__Description-q9naw2-3 hCVLFF">데이터베이스 인덱스 테이블은 메인 데이터 공간과 분리되어 있다</div><div class="post__Time-q9naw2-1 dyUQaX">2020-02-02</div><div class="post__Content-q9naw2-4 dKCvWe"><h2>인덱스 테이블 → 데이터 조회</h2>
<p>인덱스 테이블은 테이블의 레코드 데이터 공간과 분리되어 있다. 따라서 인덱스를 바탕으로 원하는 데이터가 있는 물리 주소를 알아낸 뒤에, 데이터에 접근하는 2단계 접근이 필요하다. 그러나 주소를 바탕으로 데이터 물리 주소에 직접 접근하는 것은 비용이 크다. 이와 관련있는 두 개념 "covering index" 와 "index merge" 를 살펴보자.</p>
<h2>Covering index, Index only read</h2>
<p>인덱스 조회만으로 데이터에 직접 접근하지 않고 실행이 가능하여 성능 이득을 볼 수 있다. 가령 <code>SELECT COUNT(*) FROM ... WHERE A &#x3C; 100</code> 이라는 검색조건에 A 가 인덱스로 걸려있다고 하자. 이때 A 인덱스의 개수만 세어보아도 조회 쿼리를 수행 할 수 있다. 즉 레코드의 물리 데이터 접근은 일어나지 않는 경우가 있다. 또 다른 유형은 <code>SELECT X FROM ... WHERE X &#x3C; 300</code> 으로 X 가 인덱스에 있다면 레코드의 물리 데이터 조회 없이도 쿼리를 수행할 수 있다. 이와 같은 작업 유형을 "Index only read', "covering index" 라고 한다.</p>
<p>복합키를 거는 경우 covering index 효과를 누릴 수 있다. 가령 A,B,C 컬럼 순서대로 복합키를 건 상태에서 <code>SELECT C FROM ... WHERE A='foo' and B='bar'</code> 같은 쿼리를 날리더라도 C 가 인덱스테이블에 있는 정보기 때문에 레코드의 물리 데이터 조회 없이도 인덱스만으로 쿼리가 수행 가능하다. GROUP BY 로 집계 쿼리가 많은 경우에도 복합키를 걸어 Covering index 효과를 누릴 수 있다.</p>
<h2>Index merge</h2>
<p>만약 <code>SELECT * FROM ... WHERE A='a' or B='b'</code> 라는 조건이 있고 A,B 컬럼이 각각 인덱스로 관리되었다고 치자. A 를 검색한 뒤 데이터를 가져오고, B 를 검색한뒤 데이터를 가져와서 병합하는 작업이 필요할 것이다. 이때 데이터를 가져오기 전, 인엑스만으로 집합 연산을 먼저 수행하고 그 결과를 바탕으로 데이터를 가져온다면 효율적이다.</p>
<p>인덱스 머지는 MySQL 에서 알려진 제한이 있다. 풀텍스트 인덱스에서는 인덱스 머지가 적용될 수 없다. 더불어 AND/OR 이 복잡하게 섞여있는 경우가 있다면 아래와 같이 변형시켜줘야 실행계획이 잘 선택 될 수 있다. </p>
<pre><code>(x AND y) OR z => (x OR z) AND (y OR z)
(x OR y) AND z => (x AND z) OR (y AND z)
</code></pre>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.toadworld.com/2017/04/06/speed-up-your-queries-using-the-covering-index-in-mysql"></a><a href="https://blog.toadworld.com/2017/04/06/speed-up-your-queries-using-the-covering-index-in-mysql">https://blog.toadworld.com/2017/04/06/speed-up-your-queries-using-the-covering-index-in-mysql</a></li>
<li><a href="https://www.postgresql.org/docs/12/indexes-index-only-scans.html"></a><a href="https://www.postgresql.org/docs/11/indexes-index-only-scans.html">https://www.postgresql.org/docs/11/indexes-index-only-scans.html</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/index-merge-optimization.html"></a><a href="https://dev.mysql.com/doc/refman/8.0/en/index-merge-optimization.html">https://dev.mysql.com/doc/refman/8.0/en/index-merge-optimization.html</a></li>
<li><a href="http://www.unofficialmysqlguide.com/covering-indexes.html"></a><a href="http://www.unofficialmysqlguide.com/covering-indexes.html">http://www.unofficialmysqlguide.com/covering-indexes.html</a></li>
<li><a href="http://www.yes24.com/Product/goods/27893960">데이터베이스를 지탱하는 기술</a></li>
</ul></div><div class="BuyMe__Wrapper-sc-8e0gb5-0 bBlDrk"><a href="https://www.buymeacoffee.com/jaehyunbaekblog" target="_blank"><img src="https://www.buymeacoffee.com/assets/img/custom_images/black_img.png" alt="Buy Me A Coffee"/></a></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/review/데이터베이스-covering-index-index-merge-란-무엇인가/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-6be3c7ef8a87189e9793.js"],"app":["/app-cd2e1915a6dbf9312162.js"],"component---src-pages-404-js":["/component---src-pages-404-js-2f1eb4f101347ea5d6bf.js"],"component---src-pages-about-js":["/component---src-pages-about-js-c9c632cd2a3a751f65ec.js"],"component---src-pages-index-js":["/component---src-pages-index-js-202c68957cd323b43f6f.js"],"component---src-pages-review-index-js":["/component---src-pages-review-index-js-ac61052fa692bd1cc4fc.js"],"component---src-pages-wiki-index-js":["/component---src-pages-wiki-index-js-6cdc7f21a0ea02c345f8.js"],"component---src-templates-post-js":["/component---src-templates-post-js-71924c030ab130b7cd23.js"]};/*]]>*/</script><script src="/polyfill-6be3c7ef8a87189e9793.js" nomodule=""></script><script src="/component---src-templates-post-js-71924c030ab130b7cd23.js" async=""></script><script src="/4cb257886639e7cece3b127408f64a9a0759d72b-4a877f0b9a52a4ca872b.js" async=""></script><script src="/app-cd2e1915a6dbf9312162.js" async=""></script><script src="/532a2f07-d9cf671676a4930bc377.js" async=""></script><script src="/styles-31f023f48facb69035d3.js" async=""></script><script src="/framework-82eb919642398bad2a1f.js" async=""></script><script src="/webpack-runtime-bc129be22fe40e80e254.js" async=""></script></body></html>